---
title:  "[Spring] JPA Auditingì„ í†µí•œ ìƒì„±/ìˆ˜ì • ì‹œê°„ ìë™í™”"
excerpt: ""

categories:
  - Spring

tags:
---

**[2020.12.28]** ë¶€í„° **ìŠ¤í”„ë§ ë¶€íŠ¸ì™€ AWSë¡œ í˜¼ì êµ¬í˜„í•˜ëŠ” ì›¹ ì„œë¹„ìŠ¤** ì±…ì„ í†µí•´ ìŠ¤í”„ë§ ê³µë¶€ë¥¼ ì‹œì‘í–ˆë‹¤.

ê³µë¶€í•œ ë‚´ìš©ì„ ê¸€ë¡œ ì •ë¦¬í•˜ë ¤ê³  í•œë‹¤.

ê·¸ë˜ì•¼ ë‚˜ì¤‘ì— ë‹¤ì‹œ ì°¾ì•„ë³´ë©° ê³µë¶€ í•  ìˆ˜ ìˆì„í…Œë‹ˆê¹Œ !!

## â° JPA Auditing

ë³´í†µì˜ Entity ëŠ” ì–¸ì œ ìƒì„±ëëŠ”ì§€, ì–¸ì œ ìˆ˜ì •ëëŠ”ì§€ ì‹œê°„ì„ ì €ì¥í•œë‹¤.

ì¶”í›„ì— ìœ ì§€ ë³´ìˆ˜ì— ìˆì–´ ì•„ì£¼ ì¤‘ìš”í•œ ì •ë³´ì´ê¸° ë•Œë¬¸ì´ë‹¤.

ê·¸ë ‡ë‹¤ë³´ë‹ˆ ë°ì´í„°ë² ì´ìŠ¤ì— ì €ì¥ì„ í•˜ê±°ë‚˜ ê°±ì‹ ì„ í•  ë•Œ ë§ˆë‹¤ ì‹œê°„ì„ ì €ì¥í•˜ëŠ” ì½”ë“œê°€ í•„ìš”í•˜ë‹¤.

ë§Œì•½ ë°ì´í„°ë² ì´ìŠ¤ì— í…Œì´ë¸”ì´ ì—„ì²­ ë§ë‹¤ë©´ ì¤‘ë³µ ì½”ë“œê°€ ë§ì•„ì§ˆ ê²ƒì´ë‹¤.

ì´ë•Œ JPA Auditing ì„ ì‚¬ìš©í•˜ë©´ ìë™ìœ¼ë¡œ ì‹œê°„ì„ ê´€ë¦¬í•´ ì¤€ë‹¤.

## ğŸ’¡ BaseTimeEntity

**java/com/boks/springboot/domain/BaseTimeEntity** ë¥¼ ë§Œë“¤ì–´ì£¼ì.

ì´ í´ë˜ìŠ¤ëŠ” ì•ìœ¼ë¡œ ëª¨ë“  Entity ì˜ ìƒìœ„ í´ë˜ìŠ¤ê°€ ë˜ì–´ ì‹œê°„ì„ ìë™ìœ¼ë¡œ ê´€ë¦¬í•´ ì¤„ ê²ƒì´ë‹¤.

```java
package com.boks.springboot.domain;

	...

@Getter
@MappedSuperclass  // JPA Entityë“¤ì´ ì´ í´ë˜ìŠ¤ë¥¼ ìƒì†ë°›ëŠ” ê²½ìš° í•„ë“œê°’ë„ ì¹¼ëŸ¼ìœ¼ë¡œ ì¸ì‹
@EntityListeners(AuditingEntityListener.class)  // ì‹œê°„ì— ëŒ€í•œ ê°’ì„ ìë™ìœ¼ë¡œ ë„£ì–´ì£¼ëŠ” Auditing ê¸°ëŠ¥ ì¶”ê°€
public class BaseTimeEntity {

    @CreatedDate  // Entityê°€ ìƒì„±ë˜ì–´ ì €ì¥ë  ë•Œ ì‹œê°„ì´ ìë™ ì €ì¥ ë¨
    private LocalDateTime createdDate;

    @LastModifiedDate  // Entityê°€ ì¡°íšŒë˜ì–´ ìˆ˜ì •ë  ë•Œ ì‹œê°„ì´ ìë™ ì €ì¥ ë¨
    private LocalDateTime modifiedDate;
}
```

**@MappedSuperclass**

Entity ë“¤ì´ BaseTimeEntity í´ë˜ìŠ¤ë¥¼ ìƒì†ë°›ëŠ” ê²½ìš° ì´ í´ë˜ìŠ¤ì˜ ì¹¼ëŸ¼ë“¤ë„ ë³¸ì¸ì˜ ì¹¼ëŸ¼ìœ¼ë¡œ ì¸ì‹í•œë‹¤.

ì „ë¶€ ê³µí†µìœ¼ë¡œ ê°€ì ¸ì•¼ í•  ì¹¼ëŸ¼ì´ ìˆëŠ” ê²½ìš° ì‚¬ìš©í•˜ë©´ ì¢‹ì„ ê²ƒ ê°™ë‹¤.

<br>

**@CreatedDate, @LastModifiedDate**

@EntityListener ë¥¼ í†µí•´ JPA Auditing ê¸°ëŠ¥ì„ í™œì„±í™” ì‹œí‚¨ ë’¤ ë‘ ê°€ì§€ ì–´ë…¸í…Œì´ì…˜ì„ ë„£ì–´ì£¼ë©´ ëœë‹¤.

ì²« ë²ˆì§¸ëŠ” ìƒì„± ì‹œê°„, ë‘ ë²ˆì§¸ëŠ” ìˆ˜ì • ì‹œê°„ì´ ì €ì¥ëœë‹¤.

## ğŸ”§ JPA Auditing í…ŒìŠ¤íŠ¸

ê¸°ëŠ¥ì„ ì¶”ê°€í–ˆìœ¼ë‹ˆ í…ŒìŠ¤íŠ¸ë¥¼ í•´ ë³¼ ì‹œê°„ì´ë‹¤.

ìš°ì„  Posts Entity ì— BaseTimeEntity ë¥¼ ìƒì†í•˜ì.

ê·¸ë ‡ê²Œ ë˜ë©´ Posts Entity ë„ createdDate, modifiedDate ì¹¼ëŸ¼ì„ ê°€ì§€ê²Œ ëœë‹¤.

ê·¸ë¦¬ê³  í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•´ **java/com/boks/springboot/domain/posts/PostsRepositoryTest** ì— ì½”ë“œë¥¼ ì¶”ê°€ í•œë‹¤.

```java
package com.boks.springboot.domain.posts;

	...
    
@RunWith(SpringRunner.class)
@SpringBootTest
public class PostsRepositoryTest {

	...
  
    @Test
    public void BaseTimeEntityTest() {
        // given
        LocalDateTime now = LocalDateTime.now();
        postsRepository.save(Posts.builder()
                .title("title")
                .content("content")
                .author("author")
                .build());

        // when
        List<Posts> postsList = postsRepository.findAll();

        // then
        Posts posts = postsList.get(0);
        System.out.println(">>>>>>>>>> CreateDate = " + posts.getCreatedDate()
                + " ModifiedDate = " + posts.getModifiedDate());

        assertThat(posts.getCreatedDate()).isAfter(now);
        assertThat(posts.getModifiedDate()).isAfter(now);
    }
}
```

![image](https://user-images.githubusercontent.com/54533309/103542588-80793500-4ee0-11eb-8596-d086ce88783b.png)

ë¡œê·¸ë¥¼ ë³´ë©´ ìƒì„± ì‹œê°„ê³¼ ìˆ˜ì • ì‹œê°„ì´ ì˜ ì €ì¥ë˜ì–´ ìˆëŠ” ê²ƒì„ ì•Œ ìˆ˜ìˆë‹¤.

í…ŒìŠ¤íŠ¸ í†µê³¼ !

## ğŸ“• ì •ë¦¬

ì²˜ìŒ ìŠ¤í”„ë§ì„ ê°€ì§€ê³  ì½”ë”©ì„ í•  ë•ŒëŠ” ì˜ˆì œ ì½”ë“œë¥¼ ì „ë¶€ ì´í•´í•˜ê³  ë„˜ì–´ê°€ì•¼ í•œë‹¤ê³  ìƒê°í–ˆë‹¤.

í•˜ì§€ë§Œ ì¼ë‹¨ ë¬´ì‘ì • ë”°ë¼ í•˜ë©° ì§„ë„ë¥¼ ë‚˜ê°€ë‹¤ ë³´ë‹ˆ ì´ì „ì— ì´í•´ê°€ ê°€ì§€ ì•Šì•˜ë˜ ì½”ë“œë„ ì´í•´ê°€ ê°€ëŠ” ê²½ìš°ê°€ ìˆì—ˆë‹¤.

ê·¸ë ‡ë‹¤ê³  ê·¸ëƒ¥ ë”°ë¼ ì“°ê¸°ë§Œ í•˜ëŠ” ì† ìš´ë™ì€ í•˜ë©´ ì•ˆ ë˜ë‹ˆ ì–´ëŠ ì •ë„ ì´í•´ë¥¼ í•˜ë©´ì„œ ì­‰ì­‰ ì§„ë„ë¥¼ ë‚˜ê°€ë´ì•¼ê² ë‹¤.

<br>

