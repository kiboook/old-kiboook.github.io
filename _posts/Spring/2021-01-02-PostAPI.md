---
title:  "[springboot-webserivce] Post ë“±ë¡ API ìƒì„± ë° ë¶„ì„ê³¼ í…ŒìŠ¤íŠ¸"
excerpt: ""

categories:
  - Spring

tags:
---

**[2020.12.28]** ë¶€í„° **ìŠ¤í”„ë§ ë¶€íŠ¸ì™€ AWSë¡œ í˜¼ì êµ¬í˜„í•˜ëŠ” ì›¹ ì„œë¹„ìŠ¤** ì±…ì„ í†µí•´ ìŠ¤í”„ë§ ê³µë¶€ë¥¼ ì‹œì‘í–ˆë‹¤.

ê³µë¶€í•œ ë‚´ìš©ì„ ê¸€ë¡œ ì •ë¦¬í•˜ë ¤ê³  í•œë‹¤.

ê·¸ë˜ì•¼ ë‚˜ì¤‘ì— ë‹¤ì‹œ ì°¾ì•„ë³´ë©° ê³µë¶€ í•  ìˆ˜ ìˆì„í…Œë‹ˆê¹Œ !!

## ğŸ“’ API ë¥¼ ë§Œë“¤ê¸° ìœ„í•´ í•„ìš”í•œ í´ë˜ìŠ¤

API ë¥¼ ë§Œë“¤ê¸° ìœ„í•´ì„  ì„¸ ê°€ì§€ í´ë˜ìŠ¤ê°€ í•„ìš”í•˜ë‹¤.

1. Request ë°ì´í„°ë¥¼ ë°›ì•„ì˜¬ **DTO**
2. API ìš”ì²­ì„ ë°›ì„ **Controller**
3. íŠ¸ëœì­ì…˜, ë„ë©”ì¸ ê¸°ëŠ¥ ê°„ì˜ ìˆœì„œë¥¼ ë³´ì¥í•˜ëŠ” **Service**

DTO ëŠ” Data Transfer Object ì˜ ì¤„ì„ë§ë¡œ ë°ì´í„° ê°ì²´ë¥¼ ì˜ë¯¸í•œë‹¤.

ë°ì´í„°ë¥¼ ë‹´ì•„ ì „ì†¡í•˜ëŠ” ì—­í• ì„ í•˜ê¸° ë•Œë¬¸ì— setter ëŠ” ì¡´ì¬í•˜ì§€ ì•ŠëŠ”ë‹¤.

ê¸°ì¡´ì—ëŠ” Service ì—ì„œ DAO ë¥¼ í†µí•´ ë°ì´í„°ë² ì´ìŠ¤ì— ì ‘ê·¼ í›„ ëª¨ë“  ë¡œì§ì„ ì²˜ë¦¬í–ˆë‹¤ê³  í•œë‹¤.

í•˜ì§€ë§Œ ì´ê²ƒì„ ë„ë©”ì¸ ëª¨ë¸ë¡œ ë°”ê¾¸ê²Œ ëœë‹¤ë©´ Service í´ë˜ìŠ¤ëŠ” íŠ¸ëœì­ì…˜ê³¼ ë„ë©”ì¸ ê°„ì˜ ìˆœì„œë§Œ ë³´ì¥í•´ ì£¼ê²Œ ëœë‹¤.

íŠ¸ëœì­ì…˜ì€ ë°ì´í„°ë² ì´ìŠ¤ì˜ ìƒíƒœë¥¼ ë³€ê²½í•˜ëŠ” ì‘ì—…ì˜ ë‹¨ìœ„ë¥¼ ì˜ë¯¸í•œë‹¤.

PostsSaveRequestDto, PostsService, PostsApiController ì„¸ ê°€ì§€ í´ë˜ìŠ¤ë¥¼ í†µí•´ Post ë“±ë¡ API ë¥¼ ë§Œë“¤ì–´ ë³´ë ¤ê³  í•œë‹¤.

##  ğŸ“Œ PostApiController

<a href="https://nam-ki-bok.github.io/spring/JPA/" style="color:#0FA678">[Spring] Spring Data JPA ì ìš©ê³¼ í…ŒìŠ¤íŠ¸</a> ì„ í†µí•´ JPA ê¹Œì§€ ì ìš©ì„ í•˜ê³  ë³¸ê²©ì ì¸ Posts API ë¥¼ ë§Œë“¤ê¸°ë¡œ í–ˆë‹¤.

/hello URL ë¡œ GET ìš”ì²­ì„ ë³´ë‚´ë©´ hello ë¥¼ ë°˜í™˜í•´ì£¼ëŠ” API ì™€ ë¹„ìŠ·í•œ êµ¬ì¡°ì˜€ëŠ”ë° ëª¨ë¥´ëŠ” ë¶€ë¶„ì´ ë§ì•„ ì •ë¦¬í•˜ë ¤ê³  í•œë‹¤.

**src/main/java/com/boks/springboot/web/PostsApicontroller** í´ë˜ìŠ¤ë¥¼ ë§Œë“¤ì.

```java
package com.boks.springboot.web;

import com.boks.springboot.service.posts.PostsService;
import com.boks.springboot.web.dto.PostsSaveRequestDto;
import lombok.RequiredArgsConstructor;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestBody;
import org.springframework.web.bind.annotation.RestController;

@RequiredArgsConstructor
@RestController
public class PostsApiController {
    private final PostsService postsService;

    @PostMapping("api/v1/posts")
    public Long save(@RequestBody PostsSaveRequestDto requestDto) {
        return postsService.save(requestDto);
    }
}
```

**@RequiredArgsConstructor**

ìŠ¤í”„ë§ì—ì„œ Bean ì„ ì£¼ì…ë°›ëŠ” ë°©ë²•ìœ¼ë¡œëŠ” ì„¸ ê°€ì§€ê°€ ìˆë‹¤.

@Autowired, setter, ìƒì„±ìê°€ ìˆëŠ”ë° ê°€ì¥ ì¶”ì²œí•˜ëŠ” ë°©ë²•ì€ ìƒì„±ìë¥¼ í†µí•´ ì£¼ì…í•˜ëŠ” ë°©ë²•ì´ë¼ê³  í•œë‹¤.

ë•Œë¬¸ì— ë¡¬ë³µ ì–´ë…¸í…Œì´ì…˜ì„ ì‚¬ìš©í•´ final ë¡œ ì„ ì–¸ëœ í•„ë“œë¥¼ ê°€ì§€ê³  ìƒì„±ìë¥¼ ë§Œë“ ë‹¤.

ì´ë ‡ê²Œ ë§Œë“œëŠ” ì´ìœ ëŠ” ë‚˜ì¤‘ì— í•„ë“œ ê°’ì„ ë°”ê¿€ ì¼ì´ ìˆì–´ë„ ì¼ì¼ì´ ë°”ê¿” ì¤„ í•„ìš”ê°€ ì—†ê¸° ë•Œë¬¸ì´ë‹¤.

<br>

**@RestController**

Spring MVC Controller ì—ì„œ JSON í˜•íƒœë¡œ ê°ì²´ ë°ì´í„°ë¥¼ ë°˜í™˜í•˜ëŠ” ê²½ìš° ì‚¬ìš©í•œë‹¤.

ë” ì´í•´ë¥¼ í•˜ë ¤ë©´ RESTful API ë¥¼ ì´í•´í•˜ê³  ìˆì–´ì•¼ í•˜ëŠ”ë° ë‹¤ìŒì— ë°”ì§ ê³µë¶€í•˜ê³  ì •ë¦¬í•´ì•¼ê² ë‹¤.

<br>

**@PostMapping**

ìŠ¤í”„ë§ 4.3 ë²„ì „ ì´ì „ì—ëŠ” **@RequestMapping(value = "/", method = "...")** ì˜ ì–´ë…¸í…Œì´ì…˜ì„ ì‚¬ìš©í–ˆë‹¤ê³  í•œë‹¤.

í•˜ì§€ë§Œ 4.3 ë²„ì „ ì´í›„ì—ëŠ” ë” í™•ì‹¤í•˜ê²Œ ì•Œì•„ ë³¼ ìˆ˜ ìˆë„ë¡

@PostMapping @GetMapping @DeleteMapping @PutMapping ìœ¼ë¡œ ë°”ë€Œì—ˆë‹¤ê³  í•œë‹¤.

<br>

**@RequestBody**

HTTP ìš”ì²­ì˜ body ë‚´ìš©ì„ ìë°” ê°ì²´ë¡œ ë°”ê¾¸ì–´ ì¤€ë‹¤.

ì´ ì½”ë“œì—ì„œëŠ” ê¸€ì„ ì‘ì„±í•˜ê³  ë“±ë¡ì„ ëˆ„ë¥´ë©´ ìƒì„±ë˜ëŠ” body ë‚´ìš©ì„ PostsSaveRequestDto ê°ì²´ë¡œ ë°”ê¾¸ì–´ ì¤€ë‹¤.

## âœï¸ PostsService

**src/main/java/com/boks/springboot/service/posts/PostsService** í´ë˜ìŠ¤ë¥¼ ë§Œë“¤ì.

```java
package com.boks.springboot.service.posts;

import com.boks.springboot.domain.posts.PostsRepository;
import com.boks.springboot.web.dto.PostsSaveRequestDto;
import lombok.RequiredArgsConstructor;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;

@RequiredArgsConstructor
@Service
public class PostsService {
    private final PostsRepository postsRepository;

    @Transactional
    public Long save(PostsSaveRequestDto requestDto) {
        return postsRepository.save(requestDto.toEntity()).getId();
    }
}
```

**@Transactional**

íŠ¸ëœì­ì…˜ì€ ë°ì´í„°ë² ì´ìŠ¤ì˜ ìƒíƒœë¥¼ ë°”ê¾¸ëŠ” ì‘ì—…ì˜ ë‹¨ìœ„ì´ë‹¤.

ë„¤ ê°€ì§€ì˜ ì„±ì§ˆì„ ê°€ì§€ëŠ”ë° ì›ìì„±, ì¼ê´€ì„±, ê²©ë¦¬ì„±, ì§€ì†ì„±ì´ë‹¤.

ì›ìì„±ì€ ì´ íŠ¸ëœì­ì…˜ ì•ˆì˜ ëª…ë ¹ì€ ì „ë¶€ ì‹¤íŒ¨í•˜ê±°ë‚˜ ì„±ê³µí•´ì•¼í•œë‹¤.

ì¼ë¶€ ì‘ì—…ë§Œ ì„±ê³µí•˜ê³  ì¼ë¶€ ì‘ì—…ë§Œ ì‹¤íŒ¨í•˜ëŠ” ê²½ìš°ëŠ” ì—†ì–´ì•¼í•œë‹¤.

ì´ ì–´ë…¸í…Œì´ì…˜ì„ ë„£ì–´ì£¼ë©´ ì‘ì—… ì•ˆì—ì„œ ì—ëŸ¬ê°€ ë°œìƒí•˜ëŠ” ê²½ìš° ìë™ìœ¼ë¡œ ë¡¤ë°±ì„ í•´ì¤€ë‹¤ê³  í•œë‹¤.

## ğŸ—‚ PostsSaveRequestDto

**java/com/boks/springboot/web/dto/PostsSaveRequestDto** í´ë˜ìŠ¤ë¥¼ ìƒì„±í•œë‹¤.

ì´ í´ë˜ìŠ¤ë¥¼ Request, Response ê°ì²´ë¡œ ì‚¬ìš© í•  ê²ƒì´ë‹¤.

<a href="https://nam-ki-bok.github.io/spring/JPA/" style="color:#0FA678">[Spring] Spring Data JPA ì ìš©ê³¼ í…ŒìŠ¤íŠ¸</a> ì—¬ê¸°ì„œ ë§Œë“  Entity í´ë˜ìŠ¤ì™€ ìœ ì‚¬í•˜ë‹¤.

í•˜ì§€ë§Œ ì ˆëŒ€ë¡œ Request, Response í´ë˜ìŠ¤ë¥¼ Entity í´ë˜ìŠ¤ë¡œ ì‚¬ìš©í•˜ë©´ ì•ˆëœë‹¤.

Request, Response í´ë˜ìŠ¤ëŠ” View ë¥¼ ìœ„í•œ í´ë˜ìŠ¤ë¼ì„œ ìì£¼ ë³€ê²½ì´ ë˜ê¸° ë•Œë¬¸ì´ë‹¤.

ë˜ View ë ˆì´ì–´ì™€ DB ë ˆì´ì–´ì˜ ì—­í• ì€ ì² ì €íˆ ë¶„ë¦¬í•´ ì£¼ëŠ” ê²ƒì´ ì¢‹ë‹¤.

```java
package com.boks.springboot.web.dto;

import com.boks.springboot.domain.posts.Posts;
import lombok.Builder;
import lombok.Getter;
import lombok.NoArgsConstructor;

@Getter
@NoArgsConstructor
public class PostsSaveRequestDto {
    private String title;
    private String content;
    private String author;

    @Builder
    public PostsSaveRequestDto(String title, String content, String author) {
        this.title = title;
        this.content = content;
        this.author = author;
    }

    public Posts toEntity() {
        return Posts.builder()
                .title(title)
                .content(content)
                .author(author)
                .build();
    }
}
```

**@Getter, @NoArgsConstructor**

ë¡¬ë³µì˜ ì–´ë…¸í…Œì´ì…˜ìœ¼ë¡œ getter ì™€ ê¸°ë³¸ ìƒì„±ìë¥¼ ë§Œë“¤ì–´ì¤€ë‹¤.

<br>

**@Builder**

ê¸°ì¡´ ìƒì„±ìë¥¼ ë§Œë“œëŠ” ê²ƒê³¼ ë˜‘ê°™ì§€ë§Œ toEntity ë©”ì†Œë“œ ì—ì„œì™€ ê°™ì´ í•„ë“œ ê°’ì„ ëª…í™•íˆ ë³´ì—¬ì¤˜ ì‹¤ìˆ˜ë¥¼ ë§‰ì„ ìˆ˜ ìˆë‹¤.

ë§Œì•½ ê¸°ë³¸ ìƒì„±ìë¡œ ì‚¬ìš©ì„ í•œë‹¤ë©´ ê°ì²´ ìƒì„± ê³¼ì •ì—ì„œ title ê³¼ content ì˜ ìˆœì„œê°€ ë°”ë€Œì–´ë„ ì—ëŸ¬ê°€ ë°œìƒí•˜ì§€ ì•Šê¸° ë•Œë¬¸ì´ë‹¤.

## âš™ï¸ API í…ŒìŠ¤íŠ¸

ì„¸ ê°€ì§€ í´ë˜ìŠ¤ë¥¼ í†µí•´ Post API ë¥¼ ë§Œë“¤ì—ˆë‹¤.

API ë¥¼ ë§Œë“¤ì—ˆìœ¼ë©´ ê¼­ í•´ì•¼ í•  í…ŒìŠ¤íŠ¸ê°€ ë‚¨ì•„ìˆë‹¤.

**java/com/boks/springboot/web/PostsApiControllerTest** í´ë˜ìŠ¤ë¥¼ ë§Œë“¤ì–´ì£¼ì.

```java
package com.boks.springboot.web;

import com.boks.springboot.domain.posts.Posts;
import com.boks.springboot.domain.posts.PostsRepository;
import com.boks.springboot.web.dto.PostsSaveRequestDto;
import org.junit.After;
import org.junit.Test;
import org.junit.runner.RunWith;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.context.SpringBootTest;
import org.springframework.boot.test.web.client.TestRestTemplate;
import org.springframework.boot.web.server.LocalServerPort;
import org.springframework.http.HttpStatus;
import org.springframework.http.ResponseEntity;
import org.springframework.test.context.junit4.SpringRunner;

import java.util.List;

import static org.assertj.core.api.Assertions.assertThat;

@RunWith(SpringRunner.class)
@SpringBootTest(webEnvironment = SpringBootTest.WebEnvironment.RANDOM_PORT)
public class PostsApiControllerTest {
    @LocalServerPort
    private int port;

    @Autowired
    private TestRestTemplate restTemplate;

    @Autowired
    private PostsRepository postsRepository;

    @After
    public void tearDown() throws Exception {
        postsRepository.deleteAll();
    }

    @Test
    public void uploadPost() throws Exception {
        // given
        String title = "title";
        String content = "content";

        PostsSaveRequestDto requestDto = PostsSaveRequestDto
                .builder()
                .title(title)
                .content(content)
                .author("author")
                .build();

        String url = "http://localhost:" + port + "/api/v1/posts";

        // when
        ResponseEntity<Long> responseEntity = restTemplate.postForEntity(url, requestDto, Long.class);

        // then
        assertThat(responseEntity.getStatusCode()).isEqualTo(HttpStatus.OK);
        assertThat(responseEntity.getBody()).isGreaterThan(0L);

        List<Posts> all = postsRepository.findAll();
        assertThat(all.get(0).getTitle()).isEqualTo(title);
        assertThat(all.get(0).getContent()).isEqualTo(content);
    }
}
```

ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ë¥¼ í•˜ê¸° ìœ„í•´ì„  **@MockMvcTest** ë¥¼ ì‚¬ìš©í•˜ë©´ ë˜ì§€ë§Œ

ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ ì„œë¹„ìŠ¤ê¹Œì§€ ë„˜ì–´ê°€ëŠ” í…ŒìŠ¤íŠ¸ë¥¼ í•´ì•¼í•˜ê¸° ë•Œë¬¸ì—

ì „ì²´ì ì¸ íë¦„ì„ í…ŒìŠ¤íŠ¸ í•  ìˆ˜ ìˆëŠ” **@SpringBootTest** ë¥¼ ì‚¬ìš©í•œë‹¤.

**TestRestTemplate** ëŠ” ì•„ì§ ê³µë¶€í•˜ê³  ìˆëŠ” ë‹¨ê³„ë¼ì„œ ë” ì´í•´ë¥¼ í•´ì•¼ í•  ê²ƒ ê°™ë‹¤..

![image](https://user-images.githubusercontent.com/54533309/103461017-67e11180-4d5e-11eb-8fc0-fcf3d5f970e3.png)

í…ŒìŠ¤íŠ¸ëŠ” í†µê³¼!

## ğŸ“• ì •ë¦¬

**ì½ê³  ê³µë¶€ í•´ì•¼ í•  ë‚´ìš©**

<a href="https://gmlwjd9405.github.io/2018/09/21/rest-and-restful.html" style="color:#0FA678">[Network] RESTë€? REST APIë€? RESTfulì´ë€?</a>

<a href="https://bamdule.tistory.com/51" style="color:#0FA678">[SpringÂ Boot]Â ì„ ì–¸ì Â íŠ¸ëœì­ì…˜Â @Transactional</a>

ğŸ¥® í¬ìŠ¤íŠ¸ ë“±ë¡ ê³¼ì •

1. localhost:8080 ìœ¼ë¡œ ì ‘ì†í•˜ë©´ IndexController ê°€ index.mustache ë¥¼ ìš”ì²­í•œë‹¤.
2. í™”ë©´ì— ë³´ì´ëŠ” ê¸€ ë“±ë¡ ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ \<a> íƒœê·¸ë¡œ ì¸í•´ localhost:8080/posts/save ì£¼ì†Œë¡œ ì´ë™í•œë‹¤.
3. IndexController ê°€ posts-save.mustache ë¥¼ ìš”ì²­í•œë‹¤.
4. posts-save.mustache ë¡œ êµ¬ì„±í•œ ê¸€ ì–‘ì‹ì„ í†µí•´ ê¸€ì„ ì‘ì„±í•˜ê³  ë“±ë¡ ë²„íŠ¼ì„ ëˆ„ë¥¸ë‹¤.
5. ë ˆì´ì•„ì›ƒ êµ¬ì¡°ì— ì˜í•´ footer.mustache ì— ë“¤ì–´ê°€ìˆëŠ” js íŒŒì¼ì˜ í•¨ìˆ˜ê°€ ë™ì‘í•œë‹¤.
6. ajax ë¥¼ í†µí•´ json ì„ ê°€ì ¸ì™€ /api/v1/posts ì£¼ì†Œë¡œ ë„˜ê²¨ì¤€ë‹¤.
7. PostsApiController ê°€ ë°›ì•„ì˜¨ json ì„ DTO ê°ì²´ë¡œ ë³€í™˜í•˜ê³  PostsService ì—ê²Œ ë„˜ê²¨ save ë©”ì†Œë“œë¥¼ ì‹¤í–‰í•œë‹¤.
8. PostsService ëŠ” ë°›ì•„ì˜¨ DTO ê°ì²´ë¥¼ PostsRepository ì— ë„˜ê²¨ ë°ì´í„°ë² ì´ìŠ¤ì— ì €ì¥í•œë‹¤.

<br>

