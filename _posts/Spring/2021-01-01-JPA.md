---
title:  "[springboot-webserivce] Spring Data JPA ì ìš©ê³¼ í…ŒìŠ¤íŠ¸"
excerpt: ""

categories:
  - Spring

tags:
---

**[2020.12.28]** ë¶€í„° **ìŠ¤í”„ë§ ë¶€íŠ¸ì™€ AWSë¡œ í˜¼ì êµ¬í˜„í•˜ëŠ” ì›¹ ì„œë¹„ìŠ¤** ì±…ì„ í†µí•´ ìŠ¤í”„ë§ ê³µë¶€ë¥¼ ì‹œì‘í–ˆë‹¤.

ê³µë¶€í•œ ë‚´ìš©ì„ ê¸€ë¡œ ì •ë¦¬í•˜ë ¤ê³  í•œë‹¤.

ê·¸ë˜ì•¼ ë‚˜ì¤‘ì— ë‹¤ì‹œ ì°¾ì•„ë³´ë©° ê³µë¶€ í•  ìˆ˜ ìˆì„í…Œë‹ˆê¹Œ !!

##  ğŸª JPA, ORM

JPA (Java Persistence API) ì˜ ì¤„ì„ë§ë¡œì¨ ìë°” ORM ê¸°ìˆ ì— ëŒ€í•œ í‘œì¤€ì´ë¼ê³  í•  ìˆ˜ ìˆë‹¤.

ORM (Object Relational Mapping) ì€ ë¬´ì—‡ì¼ê¹Œ ?

ë°”ë¡œ ê°ì²´ê°€ í…Œì´ë¸”ì´ ë  ìˆ˜ ìˆë„ë¡ ë§¤í•‘ ì‹œì¼œì£¼ëŠ” í”„ë ˆì„ì›Œí¬ì´ë‹¤.

ê²°êµ­ JPA ëŠ” ORM ì„ ì‚¬ìš©í•˜ê¸° ìœ„í•œ ì¸í„°í˜ì´ìŠ¤ë¥¼ ëª¨ì•„ ë‘” ê²ƒìœ¼ë¡œ ì´í•´í•˜ë©´ ëœë‹¤.

ê·¸ë ‡ë‹¤ë©´ ORM ì„ ì™œ ì‚¬ìš©í•˜ë ¤ê³  í•˜ëŠ” ê²ƒ ì¼ê¹Œ?

ê´€ê³„í˜• ë°ì´í„°ë² ì´ìŠ¤ëŠ” ì–´ë–»ê²Œ ë°ì´í„°ë¥¼ ì €ì¥í• ì§€ì— ì´ˆì ì´ ë§ì¶”ì–´ì§„ ë°˜ë©´

ìë°”ì™€ ê°™ì€ ê°ì²´ì§€í–¥ ì–¸ì–´ëŠ” ê¸°ëŠ¥ê³¼ ì†ì„±ì„ í•œ ê³³ì—ì„œ ê´€ë¦¬í•œë‹¤.

ì´ë ‡ê²Œ ê° ê¸°ìˆ ì— ëŒ€í•œ íŒ¨ëŸ¬ë‹¤ì„ì´ ë§ì§€ ì•Šì•„ ìƒê¸°ëŠ” ë¬¸ì œë¥¼ **íŒ¨ëŸ¬ë‹¤ì„ ë¶ˆì¼ì¹˜** ë¼ê³  í•˜ëŠ”ë°, ì˜ˆë¥¼ ë“¤ì–´ë³´ì

```java
User user = findUser();
Group group = user.getGroup();
```

ì´ ì½”ë“œëŠ” ëˆ„ê°€ ë´ë„ user ë¥¼ í†µí•´ group ì„ ê°€ì ¸ì˜¤ê¸° ë•Œë¬¸ì— group - user ê°„ ë¶€ëª¨ - ìì‹ ê´€ê³„ë¥¼ ì•Œ ìˆ˜ ìˆë‹¤.

í•˜ì§€ë§Œ ì´ ì½”ë“œì— ë°ì´í„°ë² ì´ìŠ¤ê°€ ì¶”ê°€ ë˜ë©´

```java
User user = userDao.findUser();
Group group = groupDao.findGroup(user.getUserID());
```

user ì™€ group ì„ ë”°ë¡œ ê²€ìƒ‰í•˜ëŠ” ë¬¸ì œê°€ ë°œìƒí•œë‹¤.

JPA ëŠ” ì´ ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ ì‚¬ìš©í•œë‹¤.

ê°œë°œìëŠ” ê°ì²´ì§€í–¥ì ìœ¼ë¡œ í”„ë¡œê·¸ë˜ë°ì„ í•˜ë©´ JPA ê°€ ì•Œì•„ì„œ SQL ë¬¸ìœ¼ë¡œ ë°”ê¾¸ì–´ ì‹¤í–‰ì„ í•´ì¤€ë‹¤.

## ğŸ¼ Spring Data JPA

JPA ëŠ” ì¸í„°í˜ì´ìŠ¤ë¥¼ ëª¨ì•„ë‘” ê²ƒ ì´ë¼ê³  í–ˆë‹¤.

ë•Œë¬¸ì— Hibernate, EclipseLink ë“± JPA ë¥¼ êµ¬í˜„í•´ë‘” êµ¬í˜„ì²´ë¥¼ ì‚¬ìš©í•œë‹¤.

í•˜ì§€ë§Œ ìŠ¤í”„ë§ì—ì„œëŠ” ì´ êµ¬í˜„ì²´ë“¤ì„ ì§ì ‘ ë‹¤ë£¨ì§€ ì•Šê³  Spring Data JPA ë¼ëŠ” ëª¨ë“ˆì„ í†µí•´ ê´€ë¦¬í•œë‹¤.

**JPA &larr;Â Hibernate &larr;Â Spring Data JPA**

ì´ë ‡ê²Œ Spring Data JPA ë¥¼ ì‚¬ìš©í•˜ë©´ ë‘ ê°€ì§€ ì¥ì ì´ ìˆë‹¤.

1. êµ¬í˜„ì²´ êµì²´ì˜ ìš©ì´ì„±
2. ì €ì¥ì†Œ êµì²´ì˜ ìš©ì´ì„±

Spring Data JPA ëŠ” êµ¬í˜„ì²´ë¥¼ ìë™ìœ¼ë¡œ ë§¤í•‘ í•´ì£¼ê¸° ë•Œë¬¸ì— êµ¬í˜„ì²´ë¥¼ Hibernate ì—ì„œ ë‹¤ë¥¸ ê²ƒìœ¼ë¡œ ë°”ê¾¸ì–´ë„ ëœë‹¤.

ë˜ ë°ì´í„°ë² ì´ìŠ¤ë¥¼ MySQL ì—ì„œ MongoDB ë¡œ ë°”ê¾¸ê³  ì‹¶ì€ ê²½ìš°ì—ë„ ì†ì‰½ê²Œ ë°”ê¿€ ìˆ˜ ìˆë‹¤.

Spring Data JPA ë¥¼ Spring Data MongoDB ë¡œ ë°”ê¾¸ê¸°ë§Œ í•˜ë©´ ëœë‹¤.

Spring Data í•˜ìœ„ í”„ë¡œì íŠ¸ì˜ CRUD êµ¬í˜„ ì¸í„°í˜ì´ìŠ¤ëŠ” ëª¨ë‘ ê°™ê¸° ë•Œë¬¸ì´ë‹¤.

## âš™ï¸ Spring Data JPA ì ìš©

ë¨¼ì € **build.gradle** íŒŒì¼ì— ë‹¤ìŒ ë‘ ê°€ì§€ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ë“±ë¡í•œë‹¤.

**compile('org.springframework.boot:spring-boot-starter-data-jpa')**

**compile('com.h2database:h2')**

```java
buildscript {
    ext {
        springBootVersion = '2.1.9.RELEASE'
    }
    repositories {
        mavenCentral()
        jcenter()
    }
    dependencies {
        classpath("org.springframework.boot:spring-boot-gradle-plugin:${springBootVersion}")
    }
}

apply plugin: 'java'
apply plugin: 'eclipse'
apply plugin: 'org.springframework.boot'
apply plugin: 'io.spring.dependency-management'

group 'com.boks'
version '1.0-SNAPSHOT'
sourceCompatibility = 1.8

repositories {
    mavenCentral()
    jcenter()
}

dependencies {
    compile('org.springframework.boot:spring-boot-starter-web')
    compile('org.projectlombok:lombok')
    compile('org.springframework.boot:spring-boot-starter-data-jpa')
    compile('com.h2database:h2')
    testCompile('org.springframework.boot:spring-boot-starter-test')
}
```

H2 ë°ì´í„°ë² ì´ìŠ¤ëŠ” ì¸ë©”ëª¨ë¦¬ ê´€ê³„í˜• ë°ì´í„°ë² ì´ìŠ¤ë¡œ ë³„ë„ì˜ ì„¤ì¹˜ê°€ í•„ìš” ì—†ì´ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¡œ ê´€ë¦¬í•  ìˆ˜ ìˆë‹¤.

ë©”ëª¨ë¦¬ì—ì„œ ëŒì•„ê°€ê¸° ë•Œë¬¸ì— í”„ë¡œê·¸ë¨ì„ ì¬ì‹œì‘í•  ë•Œë§ˆë‹¤ ì´ˆê¸°í™”ê°€ ë˜ì–´ í…ŒìŠ¤íŠ¸ ìš©ë„ë¡œ ë§ì´ ì‚¬ìš©ëœë‹¤.

<br>

<img width="300" alt="ìŠ¤í¬ë¦°ìƒ· 2021-01-01 ì˜¤í›„ 5 47 31" src="https://user-images.githubusercontent.com/54533309/103435929-6e399580-4c59-11eb-8443-af6b14265c37.png">

ë‹¤ìŒìœ¼ë¡œ domain íŒ¨í‚¤ì§€ ì•ˆì— posts íŒ¨í‚¤ì§€ë¥¼ ë§Œë“¤ê³  **Posts** í´ë˜ìŠ¤ë¥¼ ë§Œë“¤ì.

Posts í´ë˜ìŠ¤ëŠ” Entity í´ë˜ìŠ¤ë¡œ ë°ì´í„°ë² ì´ìŠ¤ì˜ í…Œì´ë¸”ê³¼ ë§¤í•‘ ë  í´ë˜ìŠ¤ì´ë‹¤.

```java
package com.boks.springboot.domain.posts;


import lombok.Builder;
import lombok.Getter;
import lombok.NoArgsConstructor;

import javax.persistence.*;

@Getter  // ë¡¬ë³µì˜ Get ìƒì„± ì–´ë…¸í…Œì´ì…˜
@NoArgsConstructor // ë¡¬ë³µì˜ ê¸°ë³¸ ìƒì„±ì ìë™ ì¶”ê°€ ì–´ë…¸í…Œì´ì…˜
@Entity  // DBì˜ í…Œì´ë¸”ê³¼ ë§¤ì¹­ ë  í´ë˜ìŠ¤ì„ì„ ë‚˜íƒ€ëƒ„
public class Posts {
    @Id  // í•´ë‹¹ í…Œì´ë¸”ì˜ PKë¥¼ ë‚˜íƒ€ëƒ„
    @GeneratedValue (strategy = GenerationType.IDENTITY)  // PK auto_increment
    private Long id;

    @Column (length = 500, nullable = false)
    private String title;

    @Column (columnDefinition = "TEXT", nullable = false)
    private String content;

    private String author;

    @Builder
    public Posts (String title, String content, String author) {
        this.title = title;
        this.content = content;
        this.author = author;
    }
}
```



@Entity ë¥¼ í†µí•´ í´ë˜ìŠ¤ë¥¼ ìƒì„±í•˜ë©´ í´ë˜ìŠ¤ëŠ” ë°ì´í„°ë² ì´ìŠ¤ì˜ í…Œì´ë¸”ì´ ëœë‹¤.

@Id ì„ í†µí•´ ê¸°ë³¸í‚¤ë¥¼ ì„¤ì •í•˜ê³  @Column ì„ í†µí•´ í…Œì´ë¸”ì˜ ì¹¼ëŸ¼ì„ ë§Œë“ ë‹¤.

@Column ì„ ì•ˆì¨ë„ í•„ë“œëŠ” ëª¨ë‘ ì¹¼ëŸ¼ì´ ë˜ì§€ë§Œ ì†ì„±ì„ ë³€ê²½í•˜ê³  ì‹¶ì€ ê²½ìš°ì— ì‚¬ìš©í•œë‹¤.

@Builder ëŠ” êµ‰ì¥íˆ ì¤‘ìš”í•œë° ê¸°ë³¸ ìƒì„±ìì™€ ê¸°ëŠ¥ì€ ê°™ì§€ë§Œ

ìƒì„±ì„ í•˜ëŠ” ê²½ìš°ì— ì–´ëŠ í•„ë“œì— ì–´ë–¤ ê°’ì„ ë„£ì–´ì•¼ í• ì§€ ì •í™•íˆ ì•Œ ìˆ˜ ìˆë‹¤.

ì´ í´ë˜ìŠ¤ëŠ” id,title, content, author ë¥¼ ì¹¼ëŸ¼ìœ¼ë¡œ ê°€ì§€ëŠ” í…Œì´ë¸”ì´ ëë‹¤.

<br>

ì´ë ‡ê²Œ Entity í´ë˜ìŠ¤ë¥¼ ìƒì„± í–ˆìœ¼ë©´ ì´ í´ë˜ìŠ¤ë¡œ ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ì ‘ê·¼í•˜ê²Œ í•´ ì¤„ **PostsRepository** ì¸í„°í˜ì´ìŠ¤ë¥¼ ìƒì„±í•œë‹¤.

```java
package com.boks.springboot.domain.posts;

import org.springframework.data.jpa.repository.JpaRepository;

public interface PostsRepository extends JpaRepository<Posts, Long> {

}
```

ì¸í„°í˜ì´ìŠ¤ë¡œ ë§Œë“  ë’¤ JpaRepository<Entity Class, PK íƒ€ì…> ì„ ìƒì†ë°›ìœ¼ë©´ ê¸°ë³¸ì ì¸ CRUD ë©”ì†Œë“œê°€ ìƒì„±ëœë‹¤.

ì´ ë•Œ ê°€ì¥ ì¤‘ìš”í•œ ë¶€ë¶„ì€ Entity í´ë˜ìŠ¤ì™€ EntityRepository ì¸í„°í˜ì´ìŠ¤ê°€ ê°™ì€ ìœ„ì¹˜ì— ìˆì–´ì•¼ í•œë‹¤.

## ğŸ”¨ Spring Data JPA í…ŒìŠ¤íŠ¸

Entity í´ë˜ìŠ¤ë„ ë§Œë“¤ê³  Repository ë„ ë§Œë“¤ì—ˆìœ¼ë‹ˆ ì •ìƒ ì‘ë™ì„ í•˜ëŠ”ì§€ í…ŒìŠ¤íŠ¸ í•  ì‹œê°„ì´ë‹¤.

ì•ì„œ í…ŒìŠ¤íŠ¸ í–ˆë˜ ê²ƒ ì²˜ëŸ¼ test í´ë”ì— ê°™ì€ ê²½ë¡œë¡œ íŒ¨í‚¤ì§€ë¥¼ ë§Œë“¤ê³  **PostsRepositoryTest** í´ë˜ìŠ¤ë¥¼ ë§Œë“¤ì.

<img width="250" alt="ìŠ¤í¬ë¦°ìƒ· 2021-01-01 ì˜¤í›„ 6 05 11" src="https://user-images.githubusercontent.com/54533309/103436139-e608bf80-4c5b-11eb-91d0-2250b83573a5.png">

```java
package com.boks.springboot.domain.posts;

import org.junit.After;
import org.junit.Test;
import org.junit.runner.RunWith;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.context.SpringBootTest;
import org.springframework.test.context.junit4.SpringRunner;

import java.util.List;

import static org.assertj.core.api.Assertions.assertThat;

@RunWith(SpringRunner.class)
@SpringBootTest
public class PostsRepositoryTest {

    @Autowired
    PostsRepository postsRepository;

    @After  // í…ŒìŠ¤íŠ¸ê°€ ëë‚œ ë’¤ ìˆ˜í–‰ í•  ë©”ì†Œë“œ ì§€ì •
    public void cleanUp() {
        postsRepository.deleteAll();
    }

    @Test
    public void findAllPosts() {
        // given
        String title = "TEST ì œëª©";
        String content = "TEST ë³¸ë¬¸";

        postsRepository.save(Posts.builder()
                .title(title)
                .content(content)
                .author("nkb7714@gmail.com")
                .build());

        // when
        List<Posts> postsList = postsRepository.findAll();

        // then
        Posts posts = postsList.get(0);
        assertThat(posts.getTitle()).isEqualTo(title);
        assertThat(posts.getContent()).isEqualTo(content);
    }
}
```

<a href="https://nam-ki-bok.github.io/spring/DTOTest/" style="color:#0FA678">[Spring] ë¡¬ë³µì„ ì´ìš©í•œ DTO ìƒì„±ê³¼ í…ŒìŠ¤íŠ¸</a> ì˜ í…ŒìŠ¤íŠ¸ì½”ë“œì™€ ë¹„ìŠ·í•˜ë‹¤.

save ë©”ì†Œë“œëŠ” posts í…Œì´ë¸”ì— insert / update ì¿¼ë¦¬ë¥¼ ì‹¤í–‰ í•œë‹¤.

findAll ë©”ì†Œë“œëŠ” í…Œì´ë¸”ì— ëª¨ë“  ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¨ë‹¤.

ê·¸ ë‹¤ìŒ assertThat ì„ í†µí•´ ì˜ ê°€ì ¸ì™”ëŠ”ì§€ í™•ì¸í•œë‹¤.

<img width="1384" alt="ìŠ¤í¬ë¦°ìƒ· 2021-01-01 ì˜¤í›„ 6 13 18" src="https://user-images.githubusercontent.com/54533309/103436278-1735bf80-4c5d-11eb-8883-ed7e23e52194.png">

ê²°ê³¼ëŠ” í†µê³¼!

## ğŸ“¡ ì¿¼ë¦¬ ë¡œê·¸ í™•ì¸

ì•„ë¬´ëŸ° ì„¤ì •ì—†ì´ ìœ„ í…ŒìŠ¤íŠ¸ ê³¼ì •ì„ ë”°ë¼ì™”ë‹¤ë©´ í…ŒìŠ¤íŠ¸ ë¡œê·¸ì— ì¿¼ë¦¬ë¬¸ì€ ë³´ì´ì§€ ì•ŠëŠ”ë‹¤.

í…ŒìŠ¤íŠ¸ë¥¼ í•  ë•Œ ì–´ë–¤ ì¿¼ë¦¬ë¬¸ì´ ë™ì‘í•˜ëŠ”ì§€ ì•Œê³  ì‹¶ë‹¤ë©´ ë‹¤ìŒê³¼ ê°™ì€ ì„¤ì •ì„ í•˜ë©´ ëœë‹¤.

**main &rarr;Â resources** í´ë”ì— **application.properties** íŒŒì¼ì„ ìƒì„±í•œë‹¤.

**spring.jpa.show-sql=true**

**spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.MySQL5InnoDBDialect**

ê·¸ë¦¬ê³  ë‘ ê°€ì§€ ì˜µì…˜ì„ ì¶”ê°€í•˜ë©´ ëœë‹¤.

ì²« ë²ˆì§¸ ì˜µì…˜ì€ ë§ ê·¸ëŒ€ë¡œ ë¡œê·¸ì— ì¿¼ë¦¬ë¬¸ì„ ë³´ì´ê²Œ í•´ì£¼ëŠ” ì˜µì…˜ì´ê³ 

ì²« ë²ˆì§¸ ì˜µì…˜ë§Œ ì ìš©í•œ ê²½ìš° H2DB ì˜ ì¿¼ë¦¬ë¬¸ì„ ë³´ì—¬ì¤€ë‹¤.

ë‘ ë²ˆì§¸ ì˜µì…˜ì€ H2DB ì˜ ì¿¼ë¦¬ë¬¸ì„ MySQL ë¡œ ë°”ê¾¸ì–´ ë³´ì—¬ì¤€ë‹¤.

ë‘ ê°€ì§€ ì˜µì…˜ì„ ì ìš©í•œ ë’¤ ë¡œê·¸ë¥¼ ë‹¤ì‹œ ë³´ë©´

![image](https://user-images.githubusercontent.com/54533309/103436375-18b3b780-4c5e-11eb-9660-f4c5c5937780.png)

ì¿¼ë¦¬ë¬¸ë„ ë¡œê·¸ë¡œ í™•ì¸ì„ í•  ìˆ˜ ìˆë‹¤.

## ğŸ“• ì •ë¦¬

ORM ì€ ê°ì²´ê°€ í…Œì´ë¸”ì´ ë  ìˆ˜ ìˆë„ë¡ ë§Œë“¤ì–´ ì£¼ëŠ” ê²ƒ..

JPA ëŠ” ORM ì˜ ê¸°ëŠ¥ì„ ì¸í„°í˜ì´ìŠ¤ë¡œ ëª¨ì•„ ë‘” ê²ƒ..

JPA ë¥¼ êµ¬í˜„í•œ êµ¬í˜„ì²´ëŠ” Hibernate, Eclipse Link ë“±ì´ ìˆìœ¼ë‚˜ Spring Data JPA ë¥¼ ì‚¬ìš©..

í…Œì´ë¸”ì„ ì˜ë¯¸í•˜ëŠ” ê°ì²´ë¥¼ Entity í´ë˜ìŠ¤ ë¼ê³  í•¨..

ì´ì œ ë“±ë¡ / ìˆ˜ì • / ì¡°íšŒ API ë§Œë“¤ ì°¨ë¡€..

<br>

